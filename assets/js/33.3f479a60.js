(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{431:function(a,t,r){"use strict";r.r(t);var s=r(2),e=Object(s.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:""}},[t("a",{staticClass:"header-anchor",attrs:{href:"#"}},[a._v("#")])]),a._v(" "),t("h1",{attrs:{id:"主要记录一些见过的架构设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主要记录一些见过的架构设计"}},[a._v("#")]),a._v(" 主要记录一些见过的架构设计")]),a._v(" "),t("h2",{attrs:{id:"redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[a._v("#")]),a._v(" Redis")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231102190157109.png",alt:"image-20231102190157109"}})]),a._v(" "),t("h3",{attrs:{id:"资源管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源管理"}},[a._v("#")]),a._v(" 资源管理")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105222310695.png",alt:"image-20231105222310695"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105222324112.png",alt:"image-20231105222324112"}})]),a._v(" "),t("ul",[t("li",[a._v("主从混部，在从节点上有RDB备份，AOF备份，导致会有cache，如果cache过多，但是free不足，可能会触发操作系统的低水位回收，会对redis的性能影响很大")]),a._v(" "),t("li",[a._v("所以有drop_page_cache这个脚本保证机器有足够的内存给redis使用")]),a._v(" "),t("li",[a._v("redis一般内存不会满，有阈值，超过阈值用LRU淘汰")]),a._v(" "),t("li",[a._v("热点key分析是用RDB，不会造成性能影响")]),a._v(" "),t("li",[a._v("当负载过高的时候，会抓取短时间的请求进行分析")]),a._v(" "),t("li",[a._v("客户端直接分片是最快的，因为可以直连，比proxy那种的好很多")])]),a._v(" "),t("h3",{attrs:{id:"集群部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群部署"}},[a._v("#")]),a._v(" 集群部署")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105222826359.png",alt:"image-20231105222826359"}})]),a._v(" "),t("ul",[t("li",[a._v("因为同一个集群可能产生流量激增，如果不分片打散的话，可能会导致同一台机器扛不住")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105223748787.png",alt:"image-20231105223748787"}})]),a._v(" "),t("h3",{attrs:{id:"自动化迁移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自动化迁移"}},[a._v("#")]),a._v(" 自动化迁移")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105223917626.png",alt:"image-20231105223917626"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105224048413.png",alt:"image-20231105224048413"}})]),a._v(" "),t("h3",{attrs:{id:"集群扩缩容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群扩缩容"}},[a._v("#")]),a._v(" 集群扩缩容")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105224351508.png",alt:"image-20231105224351508"}})]),a._v(" "),t("ul",[t("li",[t("p",[a._v("通过迁移的方式进行扩缩容，通过redisgate进行重新分配"),t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105224702710.png",alt:"image-20231105224702710"}})])]),a._v(" "),t("li",[t("p",[a._v("redis gate实际上也是一个redis节点，但是在load RDB的时侯，函数经过改造，增加一个ReplicationToServer() 方法，来对数据进行分发"),t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105225038245.png",alt:"image-20231105225038245"}})])]),a._v(" "),t("li",[t("p",[a._v("hsetCommand是redis会把RDB转换成一条一条命令来写入")])])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105225345123.png",alt:"image-20231105225345123"}})]),a._v(" "),t("ul",[t("li",[a._v("自动扩缩容"),t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105225623323.png",alt:"image-20231105225623323"}}),a._v(" "),t("ul",[t("li",[a._v("数据校验：采样")]),a._v(" "),t("li",[a._v("扩缩容会全局重连（交换namespace），但是故障只会单节点重连")])])])]),a._v(" "),t("h3",{attrs:{id:"巡检-告警-监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#巡检-告警-监控"}},[a._v("#")]),a._v(" 巡检，告警，监控")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105225843114.png",alt:"image-20231105225843114"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105230103789.png",alt:"image-20231105230103789"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231105230411015.png",alt:"image-20231105230411015"}})]),a._v(" "),t("ul",[t("li",[a._v("比如redis上云之后，大部分其他业务机器还在本地，那么访问有延迟")])]),a._v(" "),t("h2",{attrs:{id:"mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[a._v("#")]),a._v(" Mysql")]),a._v(" "),t("ul",[t("li",[a._v("用MHA来监控有单点的问题，解决方案是用Orchestrator，是开源的mysql高可用，拓扑的可视化管理工具，检测，故障转移的组件，有UI界面，在此场景下也可以作为mysql的配置中心")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231102192840450.png",alt:"image-20231102192840450"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231102193336114.png",alt:"image-20231102193336114"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20231102193521663.png",alt:"image-20231102193521663"}})]),a._v(" "),t("ul",[t("li",[a._v("在挂的时候千万不能自动切换，因为会有数据不一致性的问题")])]),a._v(" "),t("h2",{attrs:{id:"为什么微服务与高并发程序都在放弃-zookeeper"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么微服务与高并发程序都在放弃-zookeeper"}},[a._v("#")]),a._v(" 为什么微服务与高并发程序都在放弃 Zookeeper")]),a._v(" "),t("ul",[t("li",[a._v("CP设计，太慢了")])])])}),[],!1,null,null,null);t.default=e.exports}}]);