(window.webpackJsonp=window.webpackJsonp||[]).push([[239],{636:function(s,a,t){"use strict";t.r(a);var e=t(2),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"parpare-mariadb-backup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parpare-mariadb-backup"}},[s._v("#")]),s._v(" Parpare MariaDB backup")]),s._v(" "),a("h3",{attrs:{id:"test-env-info"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-env-info"}},[s._v("#")]),s._v(" Test ENV info:")]),s._v(" "),a("ul",[a("li",[s._v("asflex1(192.168.209.131, 129.69.209.127) ---\x3e controller server")]),s._v(" "),a("li",[s._v("asflex5(129.69.209.129) ---\x3e backup server")])]),s._v(" "),a("h3",{attrs:{id:"prod-env-info"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prod-env-info"}},[s._v("#")]),s._v(" Prod ENV info:")]),s._v(" "),a("ul",[a("li",[s._v("astplsm01(129.69.209.168) ---\x3e controller server")]),s._v(" "),a("li",[s._v("asflex5(129.69.209.129) ---\x3e backup server")])]),s._v(" "),a("h3",{attrs:{id:"install-the-mariadb-on-both-vms-it-is-best-that-the-master-is-an-older-version-than-the-slave-mariadb-versions-are-usually-backward-compatible"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-the-mariadb-on-both-vms-it-is-best-that-the-master-is-an-older-version-than-the-slave-mariadb-versions-are-usually-backward-compatible"}},[s._v("#")]),s._v(" Install the mariaDB on both VMs(it is best that the master is an older version than the slave. MariaDB versions are usually backward compatible)")]),s._v(" "),a("h5",{attrs:{id:"for-the-newest-version-of-mariadb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#for-the-newest-version-of-mariadb"}},[s._v("#")]),s._v(" For the newest version of mariadb")]),s._v(" "),a("p",[s._v("ref: https://www.digitalocean.com/community/tutorials/how-to-install-mariadb-on-ubuntu-22-04")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mariadb-server\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" mysql_secure_installation\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"for-mariadb-10-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#for-mariadb-10-3"}},[s._v("#")]),s._v(" For mariadb 10.3")]),s._v(" "),a("p",[s._v("ref: https://www.gb-media.biz/de/tutorials-snippets/mariadb-10.3-installieren.html")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" software-properties-common\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" apt-key adv --recv-keys "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--keyserver")]),s._v(" hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" add-apt-repository "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb [arch=amd64] http://mirror.zol.co.zw/mariadb/repo/10.3/ubuntu bionic main'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mariadb-server mariadb-client\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" mysql_secure_installation\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Enter current password for root (enter for none): <-- press enter")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set root password? [Y/n] <-- y")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# New password: <-- Enter the new MariaDB root password here")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Re-enter new password: <-- Repeat the password")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remove anonymous users? [Y/n] <-- y")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Disallow root login remotely? [Y/n] <-- y")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Reload privilege tables now? [Y/n] <-- y")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"allow-remote-access"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#allow-remote-access"}},[s._v("#")]),s._v(" Allow remote access")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/mysql/mariadb.conf.d/50-server.cnf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("change ''bind-address'' to 0.0.0.0")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230329235020454.png",alt:"image-20230329235020454"}})]),s._v(" "),a("h2",{attrs:{id:"restart-mariadb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#restart-mariadb"}},[s._v("#")]),s._v(" Restart mariadb")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h1",{attrs:{id:"configuring-master-slave-replication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuring-master-slave-replication"}},[s._v("#")]),s._v(" Configuring Master-Slave Replication")]),s._v(" "),a("p",[s._v("ref: https://mariadb.com/kb/en/setting-up-replication/")]),s._v(" "),a("h3",{attrs:{id:"on-master-db"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#on-master-db"}},[s._v("#")]),s._v(" On master DB")]),s._v(" "),a("h3",{attrs:{id:"set-the-binlog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#set-the-binlog"}},[s._v("#")]),s._v(" Set the binlog")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/mysql/mariadb.conf.d/50-server.cnf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("after [mariadb], add: (make sure the server_id is different)")]),s._v(" "),a("div",{staticClass:"language-cnf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[mariadb]\nlog-bin\nserver_id=1\nlog-basename=master-astplsm01\nbinlog-format=mixed\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"create-the-user"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-the-user"}},[s._v("#")]),s._v(" Create the user")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("CREATE "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mariabackup'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" IDENTIFIED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'passw0rd'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nGRANT ALL PRIVILEGES ON *.* TO "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mariabackup'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nFLUSH PRIVILEGES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"lock-the-table-and-do-the-backup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lock-the-table-and-do-the-backup"}},[s._v("#")]),s._v(" Lock the table and do the backup")]),s._v(" "),a("h5",{attrs:{id:"if-the-mysqldump-is-hanging-after-the-read-lock-pls-go-to-the-bottom-section-troubleshoting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#if-the-mysqldump-is-hanging-after-the-read-lock-pls-go-to-the-bottom-section-troubleshoting"}},[s._v("#")]),s._v(" !!!! If the mysqldump is hanging after the read lock, pls go to the Bottom section: Troubleshoting")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# On master: Run after login to mariadb")]),s._v("\nFLUSH TABLES WITH READ LOCK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Open a new command line on master node")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" mysqldump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" mariabackup "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" --all-databases "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" backup0815.sql\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copy the backup file to replica server")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# On replica: Run after login to mariadb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" backup0815.sql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"check-the-status-and-note-the-binlog-name-and-position"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#check-the-status-and-note-the-binlog-name-and-position"}},[s._v("#")]),s._v(" Check the status and note the binlog name and position")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("MariaDB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SHOW MASTER STATUS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+-----------------------------+----------+--------------+------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" File                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Position "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog_Do_DB "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog_Ignore_DB "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------------------+----------+--------------+------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" master-astplsm01-bin.000001 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4582432")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------------------+----------+--------------+------------------+\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"on-replica-start-replica"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#on-replica-start-replica"}},[s._v("#")]),s._v(" On replica, start replica")]),s._v(" "),a("h3",{attrs:{id:"give-the-replica-a-unique-serverid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#give-the-replica-a-unique-serverid"}},[s._v("#")]),s._v(" Give the replica a unique serverid")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/mysql/mariadb.conf.d/50-server.cnf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nserver-id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("if the replica is not set at the begining of using the database, make sure to following the steps ofthe chapter: Getting the Master's Binary Log Co-ordinates, from https://mariadb.com/kb/en/setting-up-replication/")]),s._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CHANGE MASTER TO\n  MASTER_HOST='129.69.209.168',\n  MASTER_USER='mariabackup',\n  MASTER_PASSWORD='passw0rd',\n  MASTER_PORT=3306,\n  MASTER_LOG_FILE='master-astplsm01-bin.000001',\n  MASTER_LOG_POS=4582432,\n  MASTER_CONNECT_RETRY=10;\n  \n\nSTART SLAVE;\nSHOW SLAVE STATUS \\G\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("If replication is working correctly, both the values of "),a("code",[s._v("Slave_IO_Running")]),s._v(" and "),a("code",[s._v("Slave_SQL_Running")]),s._v(" should be "),a("code",[s._v("Yes")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Slave_IO_Running: Yes\nSlave_SQL_Running: Yes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])]),s._v(" "),a("h4",{attrs:{id:"unlock-the-master-db"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unlock-the-master-db"}},[s._v("#")]),s._v(" Unlock the master db")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("UNLOCK TABLES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h1",{attrs:{id:"troubleshoting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#troubleshoting"}},[s._v("#")]),s._v(" TroubleShoting")]),s._v(" "),a("p",[s._v("If the master MariaDB vesion is higher then 10.3. We can not do the dump when holding the READ lock.")]),s._v(" "),a("p",[s._v("The solution are as follows:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Do not lock the db, and run the mysqldump command with '--master-data'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The binlog position will be shown in the begining of backup.sql")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230815151727733.png",alt:"image-20230815151727733"}})]),s._v(" "),a("p",[s._v('Then just continue with the section "On replica, start replica".')]),s._v(" "),a("h2",{attrs:{id:"create-the-crontab-to-backup-regually"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-the-crontab-to-backup-regually"}},[s._v("#")]),s._v(" Create the crontab to backup regually")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("backup_dir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/backups/openstack-mariadb-backup"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql backup")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mysql_filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${backup_dir}")]),s._v("/mysql-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("eval")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y%m%d"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v('.sql.gz"')]),s._v("\n\n/usr/bin/mysqldump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-P")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("129.69")]),s._v(".209.129 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" mariabackup "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ppassw0rd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--opt")]),s._v(" --all-databases "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mysql_filename")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# remove the file older then a week in the backup dir")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$backup_dir")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-type")]),s._v(" f "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-mtime")]),s._v(" +7 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);