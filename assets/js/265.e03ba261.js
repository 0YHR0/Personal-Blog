(window.webpackJsonp=window.webpackJsonp||[]).push([[265],{662:function(a,e,s){"use strict";s.r(e);var t=s(2),n=Object(t.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"openstack-backup-two-ways"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#openstack-backup-two-ways"}},[a._v("#")]),a._v(" Openstack backup(Two ways)")]),a._v(" "),e("table",[e("thead",[e("tr",[e("th",[a._v("Role")]),a._v(" "),e("th",[a._v("HostName")]),a._v(" "),e("th",[a._v("IP")]),a._v(" "),e("th",[a._v("MariaDB-Username")]),a._v(" "),e("th",[a._v("MariaDB-Password")])])]),a._v(" "),e("tbody",[e("tr",[e("td",[a._v("Master")]),a._v(" "),e("td",[a._v("astplsm01")]),a._v(" "),e("td",[a._v("192.168.209.143")]),a._v(" "),e("td",[a._v("mariabackup")]),a._v(" "),e("td",[a._v("passw0rd")])]),a._v(" "),e("tr",[e("td",[a._v("Worker")]),a._v(" "),e("td",[a._v("asflex5")]),a._v(" "),e("td",[a._v("192.168.209.135")]),a._v(" "),e("td"),a._v(" "),e("td")])])]),a._v(" "),e("h3",{attrs:{id:"todo"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#todo"}},[a._v("#")]),a._v(" TODO")]),a._v(" "),e("ul",[e("li",[a._v("[ ] Test recovery our test env")])]),a._v(" "),e("h2",{attrs:{id:"backup-remotely"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#backup-remotely"}},[a._v("#")]),a._v(" Backup remotely")]),a._v(" "),e("h3",{attrs:{id:"step1-create-a-role-on-master-node-to-do-the-backup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step1-create-a-role-on-master-node-to-do-the-backup"}},[a._v("#")]),a._v(" Step1. create a role on master node to do the backup")]),a._v(" "),e("p",[a._v("run after login to the DB")]),a._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("# give all privileges to the user: mariabackup, and enable it login from everywhere\ngrant all privileges on *.* to 'mariabackup'@'%' identified by 'passw0rd' with grant option;\n\n# flush\nflush privileges;\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("h3",{attrs:{id:"step2-on-asflex5-create-the-backup-dir"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step2-on-asflex5-create-the-backup-dir"}},[a._v("#")]),a._v(" Step2. On asflex5, create the backup dir")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /var/backup\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# create the backup dir")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" openstack-mariadb-backup\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# give all the permissions to all user")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("777")]),a._v(" openstack-mariadb-backup/\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br")])]),e("h3",{attrs:{id:"step3-create-the-script-for-the-mariadb-backup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step3-create-the-script-for-the-mariadb-backup"}},[a._v("#")]),a._v(" Step3. Create the script for the mariadb backup")]),a._v(" "),e("p",[a._v("name it as: asflex5-DB-backup.sh")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("backup_dir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/backups/openstack-mariadb-backup"')]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# mysql backup")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("mysql_filename")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${backup_dir}")]),a._v("/mysql-"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("hostname")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("-"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("eval")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%Y%m%d"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v('.sql.gz"')]),a._v("\n\n/usr/bin/mysqldump "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("3306")]),a._v("  "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".209.143 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" mariabackup "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ppassw0rd")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--opt")]),a._v(" --all-databases "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("gzip")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$mysql_filename")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# remove the file older then a week in the backup dir")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$backup_dir")]),a._v('"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-type")]),a._v(" f "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-mtime")]),a._v(" +7 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-exec")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br")])]),e("h3",{attrs:{id:"step4-create-a-crontab-to-do-the-backup-regularly-everyday"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step4-create-a-crontab-to-do-the-backup-regularly-everyday"}},[a._v("#")]),a._v(" Step4. Create a crontab to do the backup regularly(Everyday)")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# give the execution permission to the script")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x asflex5-DB-backup.sh\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Create or Edit Cron Jobs, This will open the user's crontab file in the default text editor.")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("crontab")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# In the crontab file, add a new line to schedule your script.")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# The general format of a cron job line is:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# * * * * * /path/to/your/script")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# minutes, hours, days, months, and days of the week")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# I do the backup every day at 20:30")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(" * * * /home/ubuntu/asflex5-DB-backup.sh\n\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# After adding your cron job, save the file and exit the text editor.")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# You can verify that your cron job has been added by listing the user's current cron jobs")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("crontab")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br")])]),e("h2",{attrs:{id:"backup-locally-on-asflex-5-using-the-master-replica-way"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#backup-locally-on-asflex-5-using-the-master-replica-way"}},[a._v("#")]),a._v(" Backup locally on asflex 5 using the master-replica way")]),a._v(" "),e("p",[a._v("see "),e("RouterLink",{attrs:{to:"/blogs/2022/OpenStack/Ch02_Localbackup_MariaDB.html"}},[a._v("ch02")])],1),a._v(" "),e("h1",{attrs:{id:"config-file-backup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#config-file-backup"}},[a._v("#")]),a._v(" Config File backup")]),a._v(" "),e("p",[a._v("ca. 1.3M")]),a._v(" "),e("h3",{attrs:{id:"step0-ssh-copy-id-for-copying-ssh-keys-to-servers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step0-ssh-copy-id-for-copying-ssh-keys-to-servers"}},[a._v("#")]),a._v(" Step0ï¼šSSH Copy ID for Copying SSH Keys to Servers")]),a._v(" "),e("h4",{attrs:{id:"on-master-machine-asflex1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#on-master-machine-asflex1"}},[a._v("#")]),a._v(" On master machine: Asflex1")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# create the user for the backup(passwd: passw0rd)")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" adduser mariabackup\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-aG")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" newusername\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/ssh/sshd_config\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# PasswordAuthentication yes")]),a._v("\n\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br")])]),e("p",[a._v("ref: https://www.ssh.com/academy/ssh/copy-id")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ssh-copy-id installs an SSH key on a server as an authorized key. Its purpose is to provide access without requiring a password for each login. This facilitates automated, passwordless logins and single sign-on using the SSH protocol.")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# generate the key pair")]),a._v("\n$ ssh-keygen\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# stored in ~/.ssh/id_rsa")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Once an SSH key has been created, the ssh-copy-id command can be used to install it as an authorized key on the server. Once the key has been authorized for SSH, it grants access to the server without a password.")]),a._v("\n$ ssh-copy-id "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" ~/.ssh/id_rsa.pub mariabackup@129.69.209.127\n\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br")])]),e("h3",{attrs:{id:"step1-add-group-on-master-asflex1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step1-add-group-on-master-asflex1"}},[a._v("#")]),a._v(" Step1. Add group on master(asflex1)")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-aG")]),a._v(" nova mariabackup\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-aG")]),a._v(" neutron mariabackup\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-aG")]),a._v(" keystone mariabackup\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-aG")]),a._v(" placement mariabackup\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-aG")]),a._v(" glance mariabackup\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-aG")]),a._v(" cinder mariabackup\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-aG")]),a._v(" ceilometer mariabackup\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +r "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-R")]),a._v(" /etc/keystone/credential-keys\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +r "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-R")]),a._v(" /etc/keystone/fernet-keys\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br")])]),e("h3",{attrs:{id:"step2-create-the-dir-to-store-the-backups"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step2-create-the-dir-to-store-the-backups"}},[a._v("#")]),a._v(" Step2. Create the dir to store the backups")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /var/backups/openstack-config-backup\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("777")]),a._v(" /var/backups/openstack-config-backup\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("h3",{attrs:{id:"step3-create-the-script-for-the-backup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step3-create-the-script-for-the-backup"}},[a._v("#")]),a._v(" Step3. Create the script for the backup")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("remote_user")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mariabackup"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("remote_host")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"129.69.209.127"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("local_dir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/backups/openstack-config-backup"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# remote_dir="/home/mariabackup"')]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("remote_dir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/home/mariabackup/backupConfigFiles"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# local_file="files_to_transfer.tar.gz"')]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# file system backup")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("fs_filename")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"fs-'),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("hostname")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("-"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("eval")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%Y%m%d"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v('.tar.gz"')]),a._v("\n\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Zip files on remote machine")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$remote_user")]),a._v('"')]),a._v("@"),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$remote_host")]),a._v('"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"tar czvf - --exclude=/var/lib/nova/instances  --exclude=/var/lib/glance/images /etc/nova /etc/neutron /etc/network/interfaces /etc/hosts /etc/mysql/mariadb.conf.d/99-openstack.cnf /etc/default/etcd /etc/keystone /var/lib/keystone /etc/apache2/apache2.conf /etc/placement/placement.conf /etc/glance /var/lib/glance /etc/cinder /var/lib/cinder /var/lib/neutron /etc/swift /etc/ceilometer /etc/heat /etc/apache2/sites-available/horizon.conf"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$local_dir")]),a._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$fs_filename")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$local_dir")]),a._v('"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-type")]),a._v(" f "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-mtime")]),a._v(" +7 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-exec")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br"),e("span",{staticClass:"line-number"},[a._v("19")]),e("br")])]),e("ul",[e("li",[e("p",[e("strong",[a._v("/etc/nova")]),a._v(" :  Configuration files for the Nova service, which is responsible for managing and orchestrating compute resources, including virtual machine instances, in an OpenStack cloud environment.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/neutron")]),a._v(": Configuration files for the Neutron service, which is responsible for managing networking and connectivity aspects of the OpenStack cloud environment")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/var/lib/nova")]),a._v(": Store various data and state information related to virtual machine instances and other operational aspects of the compute service. It's a critical directory that contains important data that the Nova service needs to manage instances, store instance disk images, and maintain state information. (Seems not needed)")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/network/interfaces")]),a._v(": Used to configure network interfaces, IP addresses, and network-related parameters on your system. It's an important configuration file for managing network interfaces and connections, especially in versions of Ubuntu prior to Ubuntu 18.04, where the networking was managed using the traditional ifupdown system.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/hosts")]),a._v(": Map hostnames to IP addresses locally on the system")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/mysql/mariadb.conf.d/99-openstack.cnf")]),a._v(": This file contains configuration options that are tailored to the requirements of OpenStack services using the MariaDB database backend.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/default/etcd")]),a._v(": Might be used in openstack.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/keystone")]),a._v(": Part of the configuration structure for the Keystone service in an OpenStack environment. Keystone is the identity service in OpenStack, responsible for authentication, authorization, and service catalog management. It provides user management, token-based authentication, and access control across all OpenStack services.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/var/lib/keystone")]),a._v(": The "),e("code",[a._v("/var/lib/keystone")]),a._v(" directory is where Keystone stores its internal databases, cache, and other runtime data.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/apache2/apache2.conf")]),a._v(": In an OpenStack deployment, the "),e("code",[a._v("/etc/apache2/apache2.conf")]),a._v(" file might play a role in configuring the Apache HTTP Server for various services and components within the OpenStack ecosystem")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/glance/glance-api.conf")]),a._v(": A configuration file specific to the Glance API service in an OpenStack environment. Glance is the OpenStack service responsible for managing and storing virtual machine images used to create instances within an OpenStack cloud.")]),a._v(" "),e("p",[a._v("The "),e("code",[a._v("glance-api.conf")]),a._v(" file contains configuration options that determine how the Glance API service behaves, how it interacts with other services, and how it manages image data.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/placement/placement.conf")]),a._v(": A configuration file specific to the Placement service in an OpenStack environment. The Placement service is responsible for managing resource inventories and allocations in an OpenStack cloud.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/glance")]),a._v(": Configuration files for the Glance service are typically located in an OpenStack environment. Glance is the OpenStack service responsible for managing and storing virtual machine images, including operating system images and snapshots.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/var/lib/glance")]),a._v(": Inside the "),e("code",[a._v("/var/lib/glance")]),a._v(" directory, you'll find different subdirectories and files that correspond to the data managed by the Glance service")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/cinder")]),a._v(": The "),e("code",[a._v("/etc/cinder")]),a._v(" directory is where configuration files for the Cinder service are typically located in an OpenStack environment. Cinder is the OpenStack service responsible for managing and providing block storage resources to instances within an OpenStack cloud.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/var/lib/cinder")]),a._v(": The "),e("code",[a._v("/var/lib/cinder")]),a._v(" directory is used by the Cinder service in OpenStack to store various data and state information required for its operation.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/var/lib/neutron")]),a._v(": The "),e("code",[a._v("/var/lib/neutron")]),a._v(" directory is used by the Neutron service in OpenStack to store various data and state information required for its operation.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/swift")]),a._v(": The "),e("code",[a._v("/etc/swift")]),a._v(" directory is where configuration files for the Swift service are typically located in an OpenStack environment. Inside the "),e("code",[a._v("/etc/swift")]),a._v(" directory, you'll find configuration files that determine how the Swift service operates, how it interacts with other OpenStack services, and how it manages object storage data.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/ceilometer")]),a._v(": The "),e("code",[a._v("/etc/ceilometer")]),a._v(" directory is where configuration files for the Ceilometer service are located in an OpenStack environment. Ceilometer is the OpenStack Telemetry service that collects data related to the usage and performance of resources and services across an OpenStack cloud.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/heat")]),a._v(": The "),e("code",[a._v("/etc/heat")]),a._v(" directory is where configuration files for the Heat service are located in an OpenStack environment. Heat is the OpenStack Orchestration service that allows you to define and manage infrastructure as code using templates. These templates can describe the architecture of your cloud application, including resources such as instances, networks, storage, and more.")])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("/etc/apache2/sites-available/horizon.conf")]),a._v(": The "),e("code",[a._v("/etc/apache2/sites-available/horizon.conf")]),a._v(" file is a configuration file for the Apache web server that's specific to the Horizon dashboard in an OpenStack environment.")])])]),a._v(" "),e("p",[a._v("give execution right:")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x backup-config-without-passwd.sh\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h3",{attrs:{id:"step4-create-crontab-for-the-backup-script"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step4-create-crontab-for-the-backup-script"}},[a._v("#")]),a._v(" Step4. Create crontab for the backup script")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Create or Edit Cron Jobs, This will open the user's crontab file in the default text editor.")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("crontab")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# In the crontab file, add a new line to schedule your script.")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# The general format of a cron job line is:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# * * * * * /path/to/your/script")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# minutes, hours, days, months, and days of the week")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# I do the backup every day at 20:30")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("40")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(" * * * /home/ubuntu/backup-config-without-passwd.sh\n\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# After adding your cron job, save the file and exit the text editor.")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# You can verify that your cron job has been added by listing the user's current cron jobs")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("crontab")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);