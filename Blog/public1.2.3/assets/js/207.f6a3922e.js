(window.webpackJsonp=window.webpackJsonp||[]).push([[207],{603:function(t,a,r){"use strict";r.r(a);var s=r(2),m=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#application"}},[t._v("#")]),t._v(" Application")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230502124145469.png",alt:"image-20230502124145469"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230425114616438.png",alt:"image-20230425114616438"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230502124543363.png",alt:"image-20230502124543363"}})]),t._v(" "),a("p",[t._v("解决方案：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("1. 布隆过滤器（先对数据进行几次哈希，再以此来匹配新的请求，来判断库内是否存在）\n2. 缓存空对象（即使返回空对象（查询失败）也进行缓存）\n")])])]),a("ul",[a("li",[t._v("但是布隆过滤器的删除也是难点，比如数据库删除的数据怎么在布隆过滤器也删除，有可能有别的key值也占用了这个hash值")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230502125759140.png",alt:"image-20230502125759140"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230502125813556.png",alt:"image-20230502125813556"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230502125835847.png",alt:"image-20230502125835847"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230502125954238.png",alt:"image-20230502125954238"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230502130044997.png",alt:"image-20230502130044997"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230502130113447.png",alt:"image-20230502130113447"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230502130704988.png",alt:"image-20230502130704988"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230502130710770.png",alt:"image-20230502130710770"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230425114706111.png",alt:"image-20230425114706111"}})]),t._v(" "),a("ul",[a("li",[t._v("比如设置了超时时间（为了避免缓存和数据库长期保持不一致）")]),t._v(" "),a("li",[t._v("但是在系统第一次部署的时候，缓存预热，把很多key设置了一样的超时时间，就会造成缓存雪崩（解决办法：使用固定值+随机值作为失效时间）")]),t._v(" "),a("li",[t._v("目前分布式缓存解决方案都很难做到和数据库强一致")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230425114715561.png",alt:"image-20230425114715561"}})]),t._v(" "),a("h2",{attrs:{id:"缓存击穿"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存击穿"}},[t._v("#")]),t._v(" 缓存击穿")]),t._v(" "),a("p",[t._v("解决方案")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("把db的执行当作一个临界资源")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("单机加锁")])]),t._v(" "),a("li",[a("p",[t._v("分布式锁"),a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20230502125237983.png",alt:"image-20230502125237983"}})]),t._v(" "),a("ul",[a("li",[a("p",[t._v("没抢到锁就阻塞等待，但是有问题会阻塞很久，可能把rpc的连接池打爆")])]),t._v(" "),a("li",[a("p",[t._v("返回一个默认值，在key-value的value里面加上逻辑过期时间，每次判断一下，如果时间过期再抢分布式锁，查询数据库并更新缓存。如果没抢到分布式锁，就直接返回逻辑上过期的数据（弱一致性）")])])])])])])])])}),[],!1,null,null,null);a.default=m.exports}}]);